{% extends "layout.html" %}
{% block styles %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
{% endblock %}
{% block content %}
<h1>Sensor Degradation Factors (AI Analysis)</h1>
 <canvas id="myChart1"></canvas>
<p>Below is the estimated importance of each factor on sensor signal loss:</p>
{{ table|safe }}
{% endblock %}
{% block scripts %}
<script>
    async function fetchData() {
        try {
            const response = await fetch('/senser', {
                headers: {
                    'Accept': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            return data; // return it for later use
        } catch (error) {
            console.error('Error fetching data:', error);
            return null;
        }
    }
   
    let datasets;

    fetchData().then(data => {
        datasets = data;
        const totalDuration = 10000;

        const delayBetweenPoints = totalDuration / datasets[1].data.length;
        const previousY = (ctx) => ctx.index === 0 ? ctx.chart.scales.y.getPixelForValue(100) : ctx.chart.getDatasetMeta(ctx.datasetIndex).data[ctx.index - 1].getProps(['y'], true).y;
        const animation = {
        x: {
            type: 'number',
            easing: 'linear',
            duration: delayBetweenPoints,
            from: NaN, // the point is initially skipped
            delay(ctx) {
            if (ctx.type !== 'data' || ctx.xStarted) {
                return 0;
            }
            ctx.xStarted = true;
            return ctx.index * delayBetweenPoints;
            }
        },
        y: {
            type: 'number',
            easing: 'linear',
            duration: delayBetweenPoints,
            from: previousY,
            delay(ctx) {
            if (ctx.type !== 'data' || ctx.yStarted) {
                return 0;
            }
            ctx.yStarted = true;
            return ctx.index * delayBetweenPoints;
            }
        }
        };

        const ctx = document.getElementById('myChart1').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: datasets
                },
                options: {
                    animation,
                    interaction: {
                        intersect: false
                    },
                    plugins: {
                        legend: false
                    },
                    scales: {
                        x: {
                            type: 'linear'
                        }
                    }
                }              
        });        
    });
</script>
{% endblock %}